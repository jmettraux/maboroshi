<!DOCTYPE html>

<html lang="en">

  <head>

    <meta charset="utf-8" />
    <!--
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    -->

    <title>å¹» maboroshi</title>

    <link href="css/maboroshi.css" rel="stylesheet" type="text/css" />

    <script src="js/h.min.js"></script>
    <script src="js/maboroshi.js"></script>
    <script src="js/qrcode.min.js"></script>
  </head>

  <body>

    <pre id="result">
    </pre>

    <div id="directory">
      <ul>
        <li><a href="/?table=monster0.md">monster0.md</a></li>
        <li><a href="/?table=monster1.md">monster1.md</a></li>
          <!-- TODO add qrcodes -->
      </ul>
    </div>

    <div id="codes">
      <div>
        <div class="self"></div>
        <div>self</div>
      </div>
      <div>
        <div class="text"></div>
        <div>text</div>
      </div>
    </div>

    <script>

      var clog = console.log;
      var cerr = console.error;

      var roll = function(table) {

        table.roll()
          .then(function(r) {

            H.setText('#result', r);
            H.unhide('#result');

            //var qt = r
            //  .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
            //  .slice(0, 4 * 1024);

            new QRCode(
              H.elt('#codes .text'),
              { text: r,
                width: 128,
                height: 128,
                colorDark: '#000000',
                colorLight: '#ffffff',
                correctLevel: QRCode.CorrectLevel.H });
          });
      };

      H.onDocumentReady(function() {

        H.hide('#result');

        var ss = window.location.search
          .split(/[?&]/)
          .filter(function(e) { return e.length > 0; });
        var table = ss.find(function(e) { return e.match(/^table=.+/); });

        if (table) {

          H.hide('#directory');

          var u = decodeURIComponent(table.slice(6));

          MaboTableSet.make(u)
            .then(roll)
            .catch(function(e) { cerr(e); })
        }

        new QRCode(
          H.elt('#codes .self'),
          { text: window.location.href,
            width: 128,
            height: 128,
            colorDark: '#000000',
            colorLight: '#ffffff',
            correctLevel: QRCode.CorrectLevel.H });
      });
    </script>
  </body>
</html>

