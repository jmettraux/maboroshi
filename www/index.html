<!DOCTYPE html>

<html lang="en">

  <head>

    <meta charset="utf-8" />
    <!--meta name="viewport" content="width=device-width, initial-scale=1" /-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />

    <title>å¹» maboroshi</title>

    <style>
/** STYLE **/
/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */
html { line-height: 1.15; -webkit-text-size-adjust: 100%; }
body { margin: 0; }
main { display: block; }
h1 { font-size: 2em; margin: 0.67em 0; }
hr { box-sizing: content-box;  height: 0;  overflow: visible; }
pre { font-family: monospace, monospace; font-size: 1em; }
a { background-color: transparent; }
abbr[title] { border-bottom: none; text-decoration: underline; text-decoration: underline dotted; }
b, strong { font-weight: bolder; }
code, kbd, samp { font-family: monospace, monospace;  font-size: 1em;  }
small { font-size: 80%; }
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }
sub { bottom: -0.25em; }
sup { top: -0.5em; }
img { border-style: none; }
button, input, optgroup, select, textarea { font-family: inherit; font-size: 100%; line-height: 1.15; margin: 0; }
button, input {  overflow: visible; }
button, select { text-transform: none; }
button, [type="button"], [type="reset"], [type="submit"] { -webkit-appearance: button; }
button::-moz-focus-inner, [type="button"]::-moz-focus-inner, [type="reset"]::-moz-focus-inner, [type="submit"]::-moz-focus-inner { border-style: none; padding: 0; }
button:-moz-focusring, [type="button"]:-moz-focusring, [type="reset"]:-moz-focusring, [type="submit"]:-moz-focusring { outline: 1px dotted ButtonText; }
fieldset { padding: 0.35em 0.75em 0.625em; }
legend { box-sizing: border-box; color: inherit; display: table; max-width: 100%; padding: 0; white-space: normal; }
progress { vertical-align: baseline; }
textarea { overflow: auto; }
[type="checkbox"], [type="radio"] { box-sizing: border-box; padding: 0; }
[type="number"]::-webkit-inner-spin-button, [type="number"]::-webkit-outer-spin-button { height: auto; }
[type="search"] { -webkit-appearance: textfield; outline-offset: -2px; }
[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }
::-webkit-file-upload-button { -webkit-appearance: button; font: inherit; }
details { display: block; }
summary { display: list-item; }
template { display: none; }
[hidden] { display: none; }



body {
  font-size: 12pt;
  font-family: monospace;
  margin: 0.5rem;
}

.hidden { display: none; }

pre {
  white-space: pre-wrap;
}

#codes {
  margin-top: 2.8rem;
}
#codes > div {
  display: inline-block;
}
#codes .label {
  margin-top: 0.5rem;
  position: relative;
}

img.copy {
  height: 16pt;
  position: absolute;
  right: 0;
  cursor: pointer;
}

#flash {
  background-color: lightgreen;
  border-radius: 15px;
  margin-top: 2rem;
  padding: 0.5rem;
  text-align: center;
  font-size: 9pt;
}

#clip {
  position: absolute;
  top: -99rem;
}

#copyright {
  margin-top: 2.8rem;
  font-size: 80%;
}


    </style>

    <script>
/** SCRIPT **/
/* jaabro-1.4.0.com.js | MIT license: https://github.com/jmettraux/jaabro/LICENSE.txt */

var Jaabro = { VERSION: '1.4.0' };
Jaabro.Input = {};
Jaabro.Input.slice = function(offset, length) {
if (offset === undefined || offset === null) offset = this.offset;
if (length === undefined) return this.string.slice(offset);
return this.string.slice(offset, offset + length);};
Jaabro.Input.match = function(str_or_rex) {
if ((typeof str_or_rex) === 'string') {
var l = str_or_rex.length;
return this.slice(this.offset, l) === str_or_rex ? l : -1;}
var m = this.slice(this.offset).match(str_or_rex);
return m !== null && m.index === 0 ? m[0].length : -1;};
Jaabro.Tree = {};
Jaabro.Tree.prune = function() {
this.children = this.children.filter(function(c) { return c.result === 1; });};
Jaabro.Tree.string = function() {
return this.input.slice(this.offset, this.length); };
Jaabro.Tree.strinp = function() {
return this.input.slice(this.offset, this.length).trim(); };
Jaabro.Tree.strim = Jaabro.Tree.strinp;
Jaabro.Tree.stringd = function() {
return this.input.slice(this.offset, this.length).toLowerCase(); }
Jaabro.Tree.strind = Jaabro.Tree.stringd;
Jaabro.Tree.stringpd = function() {
return this.input.slice(this.offset, this.length).trim().toLowerCase(); }
Jaabro.Tree.strinpd = Jaabro.Tree.stringpd;
Jaabro.Tree.lookup = function(name) {
if (name === null) { if (this.name) return this; }
else { if (this.name === name) return this; }
return this.sublookup(name);};
Jaabro.Tree.sublookup = function(name) {
for (var i = 0, l = this.children.length; i < l; i++) {
var r = this.children[i].lookup(name);
if (r) return r;}
return null;};
Jaabro.Tree.gather = function(name) {
if ( ! name) name = null;
var acc = arguments[1] || [];
if ((name === null && this.name) || (name && this.name === name))
acc.push(this);
else
this.children.forEach(function(c) { c.gather(name, acc) });
return acc;};
Jaabro.Tree.subgather = function(name) {
var acc = arguments[1] || [];
this.children.forEach(function(c) { c.gather(name, acc) });
return acc;};
Jaabro.Tree.eoChildren = function(start) {
var a = [];
for (var i = start, l = this.children.length; i < l; i = i + 2) {
a.push(this.children[i]);};
return a;};
Jaabro.Tree.oddChildren = function() { return this.eoChildren(1); };
Jaabro.Tree.evenChildren = function() { return this.eoChildren(0); };
Jaabro.Tree.toArray = function(opts) {
var cn = null;
if (this.result === 1 && this.children.length === 0){
cn = this.string();}
else {
cn = []; for (var i = 0, l = this.children.length; i < l; i++) {
cn.push(this.children[i].toArray(opts));}}
return [
this.name, this.result, this.offset, this.length, this.parter, cn ];};
Jaabro.Tree.toString = function() {
var depth = arguments[0] || 0;
var string = arguments[1] || [];
if (depth > 0) string.push('\n');
for (var i = 0; i < depth; i++) string.push('  ');
string.push(this.result, ' ', JSON.stringify(this.name), ' ');
string.push(this.offset, ',', this.length);
if (this.result === 1 && this.children.length === 0) {
string.push(' ', JSON.stringify(this.string()));}
this.children.forEach(function(c) { c.toString(depth + 1, string); });
return depth === 0 ? string.join('') : null;};
Jaabro.Tree._c = function(parentElt, tag, /*atts,*/ text) {
var ss = tag.split('.');
var e = document.createElement(ss.shift());
e.className = ss.map(function(c) { return 'jaabro' + c; }).join(' ');
e.textContent = text || '';
if (parentElt) parentElt.appendChild(e);
return e;};
Jaabro.Tree.toHtml = function(parentElement) {
var div = this._c(
parentElement, 'div.-tree.-' + (this.result === 1 ? 'success' : 'failure'));
var su = this._c(div, 'div.-summary');
var ex = this._c(div, 'div.-extra');
var noname = this.name === null;
var n = noname ? '(null)' : this.name;
var s = this.string()
.replace(/\n/g, '\u21b3').replace(/\r/g, '\u21b2');
var t = this.input.slice(this.offset, 80)
.replace(/\n/g, '\u21b3').replace(/\r/g, '\u21b2');
if (t.length === 80) t = t + '\u2026';
var f = this.parser.toString().replace('return Jaabro.', '');
var fm = f.match(/^function ([^(]+)/);
var fn = fm ? fm[1] : '(core parser)';
var cn = this.children.length;
var fcn = this.children.filter(function(c) { return c.result === 0; }).length;
var xn = noname ? '.-no-name' : '';
this._c(su, 'span.-name' + xn, n);
if (n !== fn) this._c(su, 'span.-parser', fn + '()');
this._c(su, 'span.-offlen', '[' + this.offset + ',' + this.length + ']');
var cl = this._c(su, 'span.-children-count');
this._c(cl, 'span.-total-children-count', 'cn' + cn);
this._c(cl, 'span.-failed-children-count', 'fcn' + fcn);
var ma = this._c(su, 'span.-match');
this._c(ma, 'span.-dquote', '"');
this._c(ma, 'span.-string', s);
this._c(ma, 'span.-post-string', t.slice(s.length));
this._c(ma, 'span.-dquote', '"');
this._c(ex, 'span.-parser', f);
if (this.children.length > 0) {
var cn = this._c(div, 'div.-children');
this.children.forEach(function(c) { c.toHtml(cn); });}
return div;};
Jaabro.str = function(name, input, str) {
var r = this.makeTree(
name, input, (typeof str) === 'string' ? 'str' : 'rex', Jaabro.str.caller);
var l = input.match(str, name);
if (l > -1) {
r.result = 1;
r.length = l;
input.offset = input.offset + l;}
return r;};
Jaabro.rex = Jaabro.str;
Jaabro.alt = function(name, input, parsers_) {
var ps = [];
for (var i = 2, l = arguments.length; i < l; i++) ps.push(arguments[i]);
var l = ps[ps.length - 1];
var g = false; if (l === true || l === false) { ps.pop(); g = l; }
var o = input.offset;
var r = this.makeTree(name, input, g ? 'altg' : 'alt', Jaabro.alt.caller);
var cr = null;
while (true) {
var p = ps.shift(); if ( ! p) break;
var rr = p(input);
r.children.push(rr);
input.offset = o;
if (g) {
if (rr.result === 1 && rr.length >= (cr ? cr.length : -1)) {
if (cr) cr.result = 0;
cr = rr;}
else {
rr.result = 0;}}
else {
cr = rr;
if (rr.result === 1) break;}};
if (cr && cr.result === 1) {
r.result = 1;
r.length = cr.length;
input.offset = o + r.length;}
if (input.options.prune) r.prune();
return r;};
Jaabro.altg = function(name, input, parsers_) {
var as = [];
for (var i = 0, l = arguments.length; i < l; i++) as.push(arguments[i]);
as.push(true);
return this.alt.apply(this, as);};
Jaabro.qmark = function() { return [ 0, 1 ]; };
Jaabro.star = function() { return [ 0, 0 ]; };
Jaabro.plus = function() { return [ 1, 0 ]; };
Jaabro.bang = function() { return -1; };
Jaabro.qmark.quantifier_name = 'qmark';
Jaabro.star.quantifier_name = 'star';
Jaabro.plus.quantifier_name = 'plus';
Jaabro.bang.quantifier_name = 'bang';
Jaabro.toQuantifier = function(parser) {
if (parser === '?') return this.qmark;
if (parser === '*') return this.star;
if (parser === '+') return this.plus;
if (parser === '!') return this.bang;
if (parser && parser.quantifier_name) return parser;
return null;};
Jaabro.quantify = function(parser) {
var q = this.toQuantifier(parser);
return q ? q() : false;};
Jaabro.seq = function(name, input, parsers_) {
var o = input.offset;
var r = this.makeTree(name, input, 'seq', Jaabro.seq.caller);
var cr = null;
var ps = []; for (var i = 2, l = arguments.length; i < l; i++) {
ps.push(arguments[i]);}
while (true) {
var p = ps.shift(); if ( ! p) break;
var q = this.toQuantifier(p);
if (q) throw new Error("lonely quantifier '" + q.quantifier_name + "'");
q = this.quantify(ps[0]);
if (q === -1) {
ps.shift();
cr = this.nott(null, input, p);
r.children.push(cr);}
else if (q) {
ps.shift();
cr = this.rep(null, input, p, q[0], q[1]);
r.children = r.children.concat(cr.children);}
else {
cr = p(input);
r.children.push(cr);}
if (cr.result !== 1) break;}
if (cr.result === 1) {
r.result = 1;
r.length = input.offset - o;}
else {
input.offset = o;}
return r;};
Jaabro.rep = function(name, input, parser, min, max) {
if (min === null || min === undefined || min < 0) min = 0;
if (max === null || max === undefined || max < 0) max = 0;
var o = input.offset;
var r = this.makeTree(name, input, 'rep', Jaabro.rep.caller);
var count = 0;
while (true) {
var cr = parser(input);
r.children.push(cr);
if (cr.result !== 1) break;
count = count + 1;
if (cr.length < 1) break;
if (max > 0 && count === max) break;}
if (count >= min && (max < 1 || count <= max)) {
r.result = 1;
r.length = input.offset - o;}
else {
input.offset = o;}
if (input.options.prune) r.prune();
return r;};
Jaabro.ren = function(name, input, parser) {
var cr = parser(input);
cr.name = name;
return cr;};
Jaabro.nott = function(name, input, parser) {
var o = input.offset;
var r = this.makeTree(name, input, 'nott', Jaabro.nott.caller);
var cr = parser(input);
r.children.push(cr);
r.length = 0;
r.result = cr.result === 1 ? 0 : 1;
input.offset = o;
return r;};
Jaabro.all = function(name, input, parser) {
var o = input.offset;
var l = input.string.length - o;
var r = this.makeTree(name, input, 'all', Jaabro.all.caller);
var cr = parser(input);
r.children.push(cr);
if (cr.length < l) { input.offset = o; }
else { r.result = 1; r.length = l; }
return r;};
Jaabro.eseq = function(name, input, startp, eltp, sepp, endp) {
var j = false; // jseq?
if (sepp === undefined && endp === undefined) {
j = true;
sepp = eltp; eltp = startp; startp = null;}
var o = input.offset;
var r = this.makeTree(name, input, j ? 'jseq' : 'eseq', Jaabro.eseq.caller);
r.result = 1;
var cr = null;
if (startp) {
cr = startp(input);
r.children.push(cr);
if (cr.result !== 1) r.result = 0;}
if (r.result === 1) {
var i = 1;
var count = 0;
var emptyStack = 0;
while (true) {
i = (i + 1) % 2;
cr = (i === 0 ? eltp : sepp)(input);
emptyStack = cr.length == 0 ? emptyStack + 1 : 0;
if (emptyStack > 1) cr.result = 0;
r.children.push(cr);
if (cr.result !== 1) {
if (i === 0 && count > 0) {
var lsep = r.children[r.children.length - 2];
lsep.result = 0;
input.offset = lsep.offset;}
break;}
count = count + 1;}
if (j && count < 1) r.result = 0;}
if (r.result === 1 && endp) {
cr = endp(input);
r.children.push(cr);
if (cr.result !== 1) r.result = 0;}
if (r.result === 1) r.length = input.offset - o;
else input.offset = o;
if (input.options.prune) r.prune();
return r;};
Jaabro.jseq = Jaabro.eseq;
Jaabro.make = function(fun) {
var rw_ = function(t) {
for (var i = 0, l = t.children.length; i < l; i++) {
var c = t.children[i];
if (c.length > 0 || c.name) return rewrite(c);}
return null;};
var rw = function(t) {
return eval('rewrite_' + (t.name ? t.name : ''))(t);};
var p = Object.create(Jaabro);
var funs = fun.toString();
'all alt altg eseq jseq ren rep rex seq str nott'
.split(' ')
.forEach(function(f) {
funs = funs.replace(
new RegExp("return +" + f + "\\(", 'g'),
'return Jaabro.' + f + '(');});
funs =
funs.slice(0, funs.lastIndexOf('}')) +
'var rewrite_; rewrite_ = rewrite_ || ' + rw_ + ';' +
'var rewrite; rewrite = rewrite ||' + rw + ';' +
'try { eval("root"); } catch(err) {' +
'throw new Error("missing function root() parser");' +
'};' +
'return [ root, rewrite ];' +
'}';
fun = eval('(' + funs + ')');
var rw = fun(p); // pass the parser, could be useful
p.root = rw[0];
p.rewrite = rw[1];
return p;};
Jaabro.makeParser = Jaabro.make;
Jaabro.makeInput = function(string, opts) {
var i = Object.create(Jaabro.Input);
i.string = string;
i.offset = 0;
i.options = opts || {};
return i;};
Jaabro.makeTree = function(name, input, parter, parser) {
var r = Object.create(Jaabro.Tree);
r.name = name;
r.result = 0;
r.input = input;
r.offset = input.offset;
r.length = 0;
r.parter = parter;
r.parser = parser;
r.children = [];
return r;};
Jaabro.parse = function(string, opts) {
opts = opts || {};
d = parseInt(opts.debug, 10) || 0;
if (d > 0) opts.rewrite = false;
if (d > 1) opts.all = false;
if (d > 2) opts.prune = false;
if ( ! opts.hasOwnProperty('prune')) opts.prune = true;
var t = null;
if (opts.all === false) t = this.root(this.makeInput(string, opts));
else t = Jaabro.all(null, this.makeInput(string, opts), this.root);
if (opts.prune !== false && t.result !== 1) return null;
if (t.parter === 'all') t = t.children[0];
if (opts.rewrite !== false) return this.rewrite(t);
return t;};
/* compacted from commit d981b0d on Mon Jan  3 10:40:44 JST 2022 */


// maboroshi.js


//
// MaboStringParser
////////////////////////////////////////////////////////////////////////////////

var MaboStringParser = Jaabro.makeParser(function() {

  //
  // parse

  function pbstart(i) { return rex(null, i, /\{\s*/); }
  function pbend(i)   { return str(null, i, '}'); } // keep post space for sqs
  function colon(i) { return rex(null, i, /\s*:\s*/); }
  function qmark(i) { return rex(null, i, /\s*\?\s*/); }
  function semco(i) { return rex(null, i, /\s*;\s*/); }
  function atsig(i) { return rex(null, i, /\s*@\s*/); }
  function equal(i) { return rex(null, i, /\s*=(?!=)\s*/); }

  function parstart(i) { return rex(null, i, /\(\s*/); }
  function parend(i)   { return rex(null, i, /\)\s*/); }

  function nil(i) { return rex('nil', i, /nil|null/i); }
  function boo(i) { return rex('boo', i, /true|false/i); }
  function num(i) { return rex('num', i, /\d+/); }

  function sqstring(i) { return rex('sqs', i, /'([^']|\\')+'/); }
  function dqstring(i) { return rex('dqs', i, /"([^"]|\\")+"/); } // FIXME

  function tname(i) { return rex('tname', i, /[^;}]+/); } // FIXME
  function table(i) { return seq('table', i, atsig, tname); }

  function ddice(i) { return rex('ddice', i, /([dD]\d+)+/); }
  function cdice(i) { return rex('cdice', i, /\d+[dD]\d+/); }
  function dice(i) { return alt('dice', i, cdice, ddice); }

  //function par(i) { return seq('par', i, parstart, exps, parend); }
  function par(i) { return str('par', i, '()'); } // FIXME

  function val(i) {
    return alt(null, i,
      par, dice, vname, table, sqstring, dqstring, num, boo, nil); }

  function vname(i) { return rex('vname', i, /[a-zA-Z][a-zA-Z0-9_]*/); }

  function semod(i) { return rex('sop', i, /\s*%\s*/); }
  function seprd(i) { return rex('sop', i, /\s*[\*\/]\s*/); }
  function sesum(i) { return rex('sop', i, /\s*[+-]\s*/); }
  function selgt(i) { return rex('sop', i, /\s*(<=?|>=?)\s*/); }
  function seequ(i) { return rex('sop', i, /\s*===?\s*/); }
  function seand(i) { return rex('sop', i, /\s*&&\s*/); }
  function seorr(i) { return rex('sop', i, /\s*\|\|\s*/); }

  function heter(i) { return seq('heter', i, eorr, qmark, eorr, colon); }
  function heass(i) { return seq('heass', i, vname, equal); }

  function emod(i) { return jseq('exp', i, val, semod); }
  function eprd(i) { return jseq('exp', i, emod, seprd); }
  function esum(i) { return jseq('exp', i, eprd, sesum); }
  function elgt(i) { return jseq('exp', i, esum, selgt); }
  function eequ(i) { return jseq('exp', i, elgt, seequ); }
  function eand(i) { return jseq('exp', i, eequ, seand); }
  function eorr(i) { return jseq('exp', i, eand, seorr); }
  function eter(i) { return seq('exp', i, heter, '*', eorr); }
  function eass(i) { return seq('exp', i, heass, '*', eter); }

  var exp = eass;

  function pbracket(i) { return eseq('exps', i, pbstart, exp, semco, pbend); }

  function str(i) { return rex('sqs', i, /([^{]|\\{)+/); }

  function str_or_pbracket(i) { return alt(null, i, str, pbracket); }

  function string(i) { return seq('string', i, str_or_pbracket, '+'); }
  var root = string;

  //
  // rewrite

  function _rewrite_void(t) {};

  function _rewrite_s(t) {
    return { t: t.name, s: t.string() }; }
  function _rewrite_st(t) {
    return { t: t.name, s: t.string().trim() }; }
  function _rewrite_sub(t) {
    return t.subgather().map(rewrite); }
  function _rewrite_nsub(t) {
    return { t: t.name, a: t.subgather().map(rewrite) }; }

  var rewrite_string = _rewrite_sub;

  function rewrite_exps(t) {
    return { t: 'exps', a: t.subgather().map(rewrite) }; }

  function rewrite_exp(t) {

    var a = t.subgather().map(rewrite);

    if (a.length === 1) return a[0];
    return { t: 'exp', a: a }; }

  var rewrite_heass = _rewrite_nsub;
  var rewrite_heter = _rewrite_nsub;

  function rewrite_table(t) {
    return { t: 'table', s: t.lookup('tname').string() }; }

  function rewrite_num(t) {
    return { t: 'num', n: parseInt(t.string(), 10) }; }

  var rewrite_sqs = _rewrite_s;
  var rewrite_vname = _rewrite_s;
  var rewrite_sop = _rewrite_st;

  function rewrite_cdice(t) {
    var m = t.string().match(/^(\d+)[dD](\d+)$/);
    return { t: 'dice', c: parseInt(m[1], 10), d: parseInt(m[2], 10) }; }

  function rewrite_ddice(t) {
    var ds = t.string()
      .split(/[dD]/)
      .slice(1)
      .map(function(e) { return parseInt(e, 10); });
    return { t: 'dice', ds: ds }; }

  function rewrite_dice(t) { return rewrite(t.children[0]); }

}); // end MaboStringParser


//
// MaboTableSet
////////////////////////////////////////////////////////////////////////////////

var MaboTableSet = (function() {

  "use strict";

  var self = this;

  // protected functions

  var random = function(max) {
    return 1 + Math.floor(Math.random() * (max - 1)); };

  var evals = {};

  evals.exps = function(set, n) {
    var r = null;
    n.a.forEach(function(nn) { r = evalNode(set, nn); });
    return r; };

  evals.sqs = function(set, n) {
    return n.s; };

  evals.vname = function(set, n) {
    if (n.s.match(/^[A-Z][A-Z0-9_]*$/)) {
      var root = set; while (root.parent) root = root.parent;
      return root.vars[n.s];
    }
    else {
      var s = set;
      while (true) {
        if (s.vars.hasOwnProperty(n.s)) return s.vars[n.s];
        s = s.parent; if ( ! s) break;
      }
      return null;
    } };

  evals.table = async function(set, n) {
    var t = set.tables[n.s];
    if (t) return rollOnListTable(set, t);
    if ( ! n.s.match(/\.md/)) throw 'unknown table "' + n.s + '"';
    t = await MaboTableSet.make(n.s);
    t.parent = set;
    return t.roll(); };

  evals.dice = function(set, n) {
    if (n.ds) {
      r = '';
      n.ds.forEach(function(d) { r = r + random(d); });
      return parseInt(r, 10);
    }
    var r = 0;
    for (var i = 0; i < n.c; i++) { r = r + random(n.d); }
    return r; };

  evals.num = function(set, n) {
    return n.n; }

  evals.sum = function(set, n) {
//clog('evals.sum', n);
    var mod = 1;
    var r = 0;
    for (var i = 0, l = n.a.length; i < l; i++) {
      var e = n.a[i];
      if (e.t === 'sop') mod = e.s === '+' ? 1 : -1;
      else r = r + mod * evalNode(set, e);
    }
    return r;
  };

  evals._op = function(set, n) {
    var op = n.a[1].s;
    if (op === '%') return evals.mod(set, n);
    if (op === '+' || op === '-') return evals.sum(set, n);
    if (op === '/' || op === '*') return evals.prd(set, n);
    if (op.match(/^>=?|<=?$/)) return evals.lgt(set, n);
    throw "evals. op " + op + " not implemented."; };

  evals._ass = function(set, n) {
    var l = n.a.length;
    var vnames = [];
    for (var i = 0; i < l; i++) {
      var nn = n.a[i]; if (nn.t !== 'heass') break;
      vnames.push(nn.a[0].s);
    }
    var val = evalNode(set, n.a[l - 1]);
    var root = set; while(root.parent) root = root.parent;
    vnames.forEach(function(vn) {
      if (vn.match(/^[A-Z][A-Z0-9_]*$/)) set.vars[vn] = val;
      else root.vars[vn] = val;
    });
    return val; };

  evals.exp = function(set, n) {
    if (n.a[0].t === 'heass') return evals._ass(set, n);
    return evals._op(set, n); };

  var evalNode = function(set, n) {

//clog('evalNode()', n);
    var ev = evals[n.t];
    if ( ! ev) throw "evals." + n.t + " not implemented.";
    return ev(set, n);
  };

  var evalString = async function(set, s) {

//clog('evalString()', s);
    var t = MaboStringParser.parse(s);
    if ( ! t) throw "failed to parse \"" + s + "\"";

    var a1 = [];
      //
    for (var i = 0, l = t.length; i < l; i++) {
      a1.push(await evalNode(set, t[i]));
    }

    return a1.join('');
  };

  var rollOnListTable = function(set, table) {

//clog('rollOnListTable()', table);
    var i = Math.floor(Math.random() * table.entries.length);
    return evalString(set, table.entries[i]);
  };

  var tableSetFunctions = {

    roll: function() {
      var t = this.tables[this.main];
      if ( ! t) return "didn't find table \"" + this.main + '"';
//clog('roll()', t);
      if (t.type === 'string') return evalString(this, t.string);
      return rollOnListTable(this, t);
    }
  };

  var addFunctions = function(table) {

    for (var k in tableSetFunctions) {
      table[k] = tableSetFunctions[k].bind(table); }

    return table;
  };

  var parseMdSplit = function(s) {

    var r = [];
    var t = 'h1';
    var n = null;
    var a = [];
    var m = null;

    s.split(/\r\n|\r|\n/).forEach(function(l) {

      if (l.trimStart().startsWith('<!--')) return;

      m = l.match(/^(#+)\s+(.+)$/);
      if (m) {
        if (n) { r.push({ name: n, type: t, lines: a }); n = null; a = []; }
        t = m[1].length > 1 ? 'h2' : 'h1'; n = m[2];
        return;
      }

      a.push(l);
    });
    r.push({ name: n, type: t, lines: a }); // over.

    return r;
  };

  var parseMdExpandString = function(sct) {

    return { type: 'string', string: sct.lines.join('\n') };
  };

  var parseMdExpandOl = function(sct) {

    var ls = sct.lines.filter(function(l) { return l.trim().length > 0; });

    if ( ! ls.every(function(l) {
      return l.match(/^\d+\.\s+[^\s]/) || l.match(/^\s+[^\s]/); })
    ) return null;

    var m = null;
    var i = -1;
    var r = { name: sct.name, type: sct.type, l: 'ol', entries: [] };
    ls.forEach(function(l) {
      m = l.match(/^\d+\.\s+(.+)$/);
      if (m) { r.entries.push(m[1]); return; }
      m = l.match(/^\s+(.+)$/);
      i = r.entries.length - 1;
      r.entries[i] = r.entries[i] + ' ' + m[1];
    });
    return r;
  };

  var parseMdExpandUl = function(sct) {

//clog('parseMdExpandUl()', sct);
    var x = /^\*\s+(.+)$/;
    var ls = sct.lines.filter(function(l) { return l.trim().length > 0; });

    if ( ! (ls[0] || '').match(x)) return false;
    if ( ! ls.find(function(l) { return l.match(x); })) return false;

    var r = { name: sct.name, type: sct.type, l: 'ul', entries: [] };
    var m, s;

    ls.forEach(function(l) {
      m = l.match(x);
      if (m) {
        r.entries.push(m[1]);
      }
      else {
        var i = r.entries.length - 1;
        var v = l.trimStart(); v = v === '|' ? '' : v;
        r.entries[i] = r.entries[i] + '\n' + v;
      }
    });

    return r;
  };

  var parseMdExpandDl = function(sct) {

    var rangeKey = function(l) {
      var m = l.match(/^(\d+)\s*-\s*(\d+)/);
      return m ? (parseInt(m[2], 10) - parseInt(m[1], 10) + 1) : false;
    };
    var stringKey = function(l) {
      return l.match(/^[^:\s]/) ? 1 : false;
    };
    var colonValue = function(l) {
      var m = l.match(/^:\s+([^\s].+)$/);
      return m ? m[1] : false;
    };
    var spaceValue = function(l) {
      var m = l.match(/^\s+([^\s].+)$/);
      return m ? m[1] : false;
    };

    if ( ! sct.lines.find(colonValue)) return false;

    var r = { name: sct.name, type: sct.type, l: 'dl', entries: [] };

    var l, k, v, c, s;

    for (var i = 0, j = sct.lines.length; i < j; i++) {

      l = sct.lines[i];

      k = rangeKey(l) || stringKey(l);
      if (k) {
        if (c) for (var ii = 0; ii < c; ii++) r.entries.push(s);
        c = k;
        s = null;
        continue;
      }

      v = colonValue(l); if (v) { s = s ? s + '\n' + v : v; continue; }
      v = spaceValue(l); if (v) { s = s ? s + ' ' + v : v; continue; }

      return false; // not a <dl>
    }

    for (var ii = 0; ii < c; ii++) r.entries.push(s);

    return r;
  };

  var parseMdExpand = function(sct) {

    return(
      parseMdExpandOl(sct) ||
      parseMdExpandUl(sct) ||
      parseMdExpandDl(sct) ||
      parseMdExpandString(sct));
  };

  var parseMd = function(s) {

    var r = { main: null, tables: {}, vars: {}, parent: null };
    parseMdSplit(s).forEach(function(section) {
      if (section.type === 'h1' && ! r.main) r.main = section.name;
      r.tables[section.name] = parseMdExpand(section);
    });

    return r;
  };

  // public functions

  this.debugEval = function(s) {

    var t = MaboStringParser.parse(s);
    var h = arguments[1] || { vars: {} };

    return [ evalNode(h, t[0]), h ];
  };

  this.doMake = function(uri, s) {

    return addFunctions(parseMd(s));
  };

  this.make = async function(uri) {

    var res = await fetch(uri);

    if ( ! res.ok) {
      throw new Error(`HTTP ${res.status} ${res.statusText} for ${uri}`);
    }

    var s = await res.text();

    return self.doMake(uri, s);
  };

  // done.

  return this;

}).apply({}); // end MaboTableSet


/* h-1.2.0.min.js | MIT license: https://github.com/jmettraux/h.js/LICENSE.txt */var H=function(){var f=this;this.VERSION="1.2.0";this.toArray=function(b){return Array.prototype.slice.call(b)};var w=function(b){return b.replace(/\[-([-_a-zA-Z0-9]+)(=|\])/g,"[data-$1$2")},t=function(b,d,a){d=w(d);return a?b.querySelectorAll(d):b.querySelector(d)},x=function(b,d){d||(d=b,b=document);b||(b=document);"string"===typeof b&&(b=t(document,b));return[b,d]},h=function(b,d){var a=x(b,d),c=a[0];d=a[1];if("string"!==typeof d)return d;if(a=d.match(/^\^([^ ]+)(.*)$/))c=f.closest(c,a[1]),d=a[2].trim();
return c?d?t(c,d):c:null},m=function(b,d){var a=x(b,d),c=a[0];d=a[1];a=null;if("string"===typeof d){if(a=d.match(/^\^([^ ]+)(.*)$/))c=f.closest(c,a[1]),d=a[2].trim();a=0<d.length?t(c,d,!0):[c]}else a=[d];for(var c=[],e=0,g=a.length;e<g;e++)c.push(a[e]);return c};this.isElt=this.isElement=function(b){return"object"===typeof b&&"string"===typeof b.tagName&&"function"===typeof b.getElementsByClassName};this.elt=function(b,d){return h(b,d)};this.elts=function(b,d){return m(b,d)};this.count=function(b,
d){return m(b,d).length};this.forEach=function(b,d,a){"function"===typeof d&&(a=d,d=null);b=m(b,d);b.forEach(a);return b};this.map=function(b,d,a){"function"===typeof d&&(a=d,d=null);return m(b,d).map(a)};this.filter=function(b,d,a){"function"===typeof d&&(a=d,d=null);return m(b,d).filter(a)};this.find=function(b,d,a){"function"===typeof d&&(a=d,d=null);return m(b,d).find(a)};this.tdim=function(b,d){var a=h(b,d);if(!a)return null;for(var c=0,e=0,g=a;g;)c+=g.offsetLeft,e+=g.offsetTop,g=g.offsetParent;
return{top:e,bottom:e+a.offsetHeight,left:c,right:c+a.offsetWidth,height:a.offsetHeight,width:a.offsetWidth}};this.dim=function(b,d){var a=h(b,d);return a?{top:a.offsetTop,bottom:a.offsetTop+a.offsetHeight,left:a.offsetLeft,right:a.offsetLeft+a.offsetWidth,height:a.offsetHeight,width:a.offsetWidth}:null};this.bdim=function(b,d){var a=h(b,d);if(!a)return null;var c=a.getBoundingClientRect(),e=f.elt("body").getBoundingClientRect();return{top:c.top-e.top,bottom:e.bottom-c.bottom,left:c.left-e.left,right:e.right-
c.right,height:a.offsetHeight,width:a.offsetWidth}};this.path=function(b,d){var a=h(b,d);if(!a)return null;if(a.id)return"#"+a.id;var c=f.path(a.parentElement),e=a.nodeName.toLowerCase(),g=f.classArray(a),g=0<g.length?"."+g.join("."):"",k=a.getAttribute("name"),k=k?'[name="'+k+'"]':"";if(""!==g||""!==k)return c+" > "+e+g+k;for(e=0;a;)1===a.nodeType&&e++,a=a.previousSibling;return c+" > :nth-child("+e+")"};var y=function(b,d,a,c,e){e||(e=c,c=a,a=d,d=document);if("function"!==typeof e)throw"eventHandler is missing";
c=Array.isArray(c)?c:[c];d=m(d,a);for(a=0;;a++){var g=d[a];if(!g)break;c.forEach(function(a){"on"===b?g.addEventListener(a,e):g.removeEventListener(a,e)})}};this.on=function(b,d,a,c){y("on",b,d,a,c)};this.off=function(b,d,a,c){y("off",b,d,a,c)};this.toNode=function(b,d){if("string"!==typeof b)return d?f.elt(b,d):b;var a=document.createElement("div");a.innerHTML=b;a=a.children[0];return d?f.elt(a,d):a};var z=function(b,d,a){return function(c){"load"===b?console.log([d+" "+a,c]):console.log([d+" "+
a+" connection problem",c])}},F=function(b){if("object"!==typeof b)return!1;for(var d in b)if("string"!==typeof b[d]||!d.match(/^[A-Z][A-Za-z0-9-]+$/))return!1;return!0};this.request=function(b,d,a,c,e){var g,k,f;if(5<=arguments.length)g=a,k=c,f=e;else if(4===arguments.length)F(a)?g=a:k=a,f=c;else if(3===arguments.length)f=a;else throw"not enough arguments for H.request";"function"===typeof f&&(f={onok:f});g||(g={});var l=new XMLHttpRequest;l.open(b,d,!0);for(var h in g)l.setRequestHeader(h,g[h]);
k&&(h=typeof k,g=g["Content-Type"]||"/json",k.constructor.toString().match(/FormData/)||(g.match(/\/json\b/)||"string"!==h?(l.setRequestHeader("Content-Type","application/json; charset=UTF-8"),k="string"===h?k:JSON.stringify(k)):k=k.toString()));var m=performance.now();l.onload=function(){var a={status:l.status,request:l,duration:(performance.now()-m)/1E3,data:null};try{a.data=JSON.parse(l.responseText)}catch(c){}if(f.onok&&200===l.status)f.onok(a);else(f.onload||z("load",b,d))(a)};l.onerror=f.onerror||
z("error",b,d);if(f.ontimeout||f.timeout)l.timeout=f.timeout||1E4,l.ontimeout=f.ontimeout;l.send(k)};this.upload=function(b,d,a,c){c||(c=a,a={});var e=new FormData,g;for(g in a)e.append(g,a[g]);var k=Array.isArray(d),h=k?d:[d],l=0;h.forEach(function(a){for(var b=a.files,c=0,d=b.length;c<d;c++){l+=1;for(var g=b[c],d=null,f=0,h=a.attributes.length;f<h;f++){var m=a.attributes.item(f);if(m.name.match(/^data-(.*-)?lang$/)){d=m.value;break}}f="file-";if(d||k)f=f+a.name+"-";d&&(f=f+d+"-");f+=c;e.append(f,
g,g.name)}});if(1>l)return 0;var m=c.onok;c.onok=function(a){!1!==c.clear&&h.forEach(function(a){a.value=""});m(a)};f.request("POST",b,e,c);return l};this.matches=function(b,d,a){a||(a=d,d=b,b=null);b=h(b,d);if(b.matches)return b.matches(a);if(b.matchesSelector)return b.matchesSelector(a);if(b.msMatchesSelector)return b.msMatchesSelector(a);throw"H.js got fed something that doesn't respond to .matches() or .matchesSelector()";};this.closest=function(b,d,a){a||(a=d,d=b,b=null);b=h(b,d);a=w(a);return f.matches(b,
a)?b:b.parentElement?f.closest(b.parentElement,a):null};this.style=function(b,d){var a=h(b,d),c={},e=null;if(window.getComputedStyle){for(var e=window.getComputedStyle(a,null),a=0,g=e.length;a<g;a++){var f=e[a],m=f.replace(/-([a-za])/g,function(a,b){return b.toUpperCase()});c[m]=e.getPropertyValue(f)}return c}if(e=a.currentStyle){for(f in e)c[f]=e[f];return c}if(e=a.style)for(f in e)a=e[f],"function"!==typeof a&&(c[f]=a);return c};this.hasc=this.hasClass=function(b,d,a){a||(a=d,d=b,b=null);b=h(b,
d);"."===a[0]&&(a=a.substring(1));try{return b.classList?b.classList.contains(a):(new RegExp("\\b"+a+"\\b")).test(b.className)}catch(c){return!1}};this.isHidden=function(b,d){var a=f.toArray(arguments);a.push(".hidden");return f.hasClass.apply(null,a)};this.isInvalid=function(b,d){return f.matches(h(b,d),":invalid")};this.isValid=function(b,d){return!f.matches(h(b,d),":invalid")};var u=function(b,d,a,c,e){f.forEach(b,d,function(b){var d=("function"===typeof a?a(b):a)?c:e;d&&d(b)})},A=function(b,d,
a){d.split(/[ .]+/).forEach(function(c){if(!(1>c.length))b.classList["r"===a?"remove":"add"](c)})},r=function(b,d){var a=b[0],c=b[1],e=b[2],f=b[3];if(2>b.length)throw"at least 2 arguments required";return 2===b.length?{sta:a,sel:null,nam:c,las:d}:3<b.length?{sta:a,sel:c,nam:e,las:f}:"string"===typeof e&&e.match(/^\.?[^ ]+$/)?{sta:a,sel:c,nam:e,las:d}:{sta:a,sel:null,nam:c,las:e}},n=function(b,d,a,c,e){var f=function(b){A(b,a,"a")},k=function(b){A(b,a,"r")},h=f,l=k;"ra"===e?(h=k,l=f):"a"===e?l=null:
"r"===e&&(h=k,l=null);u(b,d,c,h,l)};this.addc=this.addClass=function(b,d,a,c){var e=r(arguments,!0);n(e.sta,e.sel,e.nam,e.las,"a")};this.remc=this.remClass=this.removeClass=function(b,d,a,c){var e=r(arguments,!0);n(e.sta,e.sel,e.nam,e.las,"r")};this.togc=this.toggle=this.toggleClass=function(b,d,a){a||(a=d,d=b,b=null);n(b,d,a,function(b){return!f.hasClass(b,a)},"ar")};this.setc=this.setClass=function(b,d,a,c){var e=r(arguments,!0);n(e.sta,e.sel,e.nam,e.las,"ar")};this.renameClass=function(b,d,a,c){c||
(c=a,a=d,d=b,b=null);u(b,d,function(b){return f.hasClass(b,a)},function(b){f.removeClass(b,a);f.addClass(b,c)},null)};this.classArray=function(b,d){for(var a=f.elt(b,d),c=a.classList||a.className.split(" "),e=[],g=0,c=a.classList.length;g<c;g++)e.push(a.classList[g]);return e};var p=function(b,d){var a=b[0],c=b[1],e=b[2];if(Number.isInteger(c)&&-1<c&&Array.isArray(e)||1===b.length)return{sta:a,sel:null,las:d};if(2<b.length)return{sta:a,sel:c,las:e};if(2===b.length)return"string"===typeof c?{sta:a,
sel:c,las:d}:{sta:a,sel:null,las:c};throw"called without arguments";},q=function(b,d){var a=p(b,d);a.elt=f.elt(a.sta,a.sel);a.elt&&(a.v="value"in a.elt?a.elt.value:void 0,a.v&&(a.v=a.v.trim()),a.t=a.elt.textContent.trim(),a.tov=B(a.v)?a.t:a.v);return a};this.show=function(b,d,a){var c=p(arguments,!0);n(c.sta,c.sel,".shown",c.las,"ar")};this.unshow=function(b,d,a){var c=p(arguments,!0);n(c.sta,c.sel,".shown",c.las,"ra")};this.hide=function(b,d,a){var c=p(arguments,!0);n(c.sta,c.sel,".hidden",c.las,
"ar")};this.unhide=function(b,d,a){var c=p(arguments,!0);n(c.sta,c.sel,".hidden",c.las,"ra")};var C=function(b,d,a,c){var e=function(a){a.removeAttribute("disabled")},f=function(a){a.setAttribute("disabled","disabled")};u(b,d,a,"e"===c?e:f,"e"===c?f:e)};this.enable=function(b,d,a){var c=p(arguments,!0);C(c.sta,c.sel,c.las,"e")};this.disable=function(b,d,a){var c=p(arguments,!0);C(c.sta,c.sel,c.las,"d")};this.cenable=function(b,d,a){var c=p(arguments,!0);n(c.sta,c.sel,".disabled",c.las,"ra")};this.cdisable=
function(b,d,a){var c=p(arguments,!0);n(c.sta,c.sel,".disabled",c.las,"ar")};this.isDisabled=function(b,d){var a=h(b,d);return"string"===typeof a.getAttribute("disabled")||f.hasClass(a,".disabled")};this.satt=this.setAtt=function(b,d,a,c){4>arguments.length&&(c=a,a=d,d=null);"-"===a.slice(0,1)&&(a="data"+a);m(b,d).forEach(null===c?function(b){b.removeAttribute(a)}:function(b){b.setAttribute(a,c)});return c};this.ratt=this.remAtt=function(b,d,a){var c=r(arguments,void 0);"-"===c.nam.slice(0,1)&&(c.nam=
"data"+c.nam);m(c.sta,c.sel).forEach(function(a){a.removeAttribute(c.nam)})};this.getAtt=function(b,d,a){var c=r(arguments,void 0),e=/(.*\[([-_a-zA-Z0-9]+)\].*)+/,g=c.sel&&c.sel.match(e),e=c.nam&&c.nam.match(e);!c.sel&&c.nam&&e?(c.sel=c.nam,c.nam=e[e.length-1]):g&&(c.las=c.nam,c.nam=g[g.length-1]);e=f.elt(c.sta,c.sel);if(!e)return c.las;c.nam&&"-"===c.nam.substr(0,1)&&(c.nam="data"+c.nam);var k=c.las;"string"===typeof k&&"-"===k.substr(0,1)&&(k="data"+k);g=e.getAttribute(g&&e.hasAttribute(k)?k:c.nam);
return null===g?c.las:g};this.getAtti=function(b,d,a){var c=f.getAtt.apply(null,arguments),c=parseInt(""+c,10);return-1<D.indexOf(c)?null:c};this.getAttf=function(b,d,a){var c=f.getAtt.apply(null,arguments),c=parseFloat(""+c);return-1<D.indexOf(c)?null:c};this.att=this.getAtt;this.atti=this.getAtti;this.attf=this.getAttf;var D=[!1,null,void 0,NaN,""];this.text=function(b,d){var a=q(arguments);if(!a.elt)throw"elt not found, no text";var c=a.elt.textContent.trim();return""===c&&a.las?a.las:c};this.getText=
function(b,d){var a=q(arguments);if(!a.elt)return a.las;var c=a.elt.textContent.trim();return""===c&&a.las?a.las:c};this.texti=function(b,d){var a=q(arguments);if(!a.elt)throw"elt not found, no text";var c=a.elt.textContent.trim();""===c&&(c=""+a.las);return parseInt(c,10)};this.textf=function(b,d){var a=q(arguments);if(!a.elt)throw"elt not found, no text";var c=a.elt.textContent.trim();""===c&&(c=""+a.las);return parseFloat(c)};this.get=function(b,d){var a=f.toArray(arguments),c=!0;"boolean"===typeof a[a.length-
1]&&(c=a.pop());a=(a=(a=f.elt.apply(null,a))?a.value:null)?a.trim():"";return!1===c&&0===a.length?null:a};var v=function(b){"string"===typeof b&&(b=b.toLowerCase());return!0===b||"true"===b||"yes"===b};this.isTrue=v;var B=function(b){return null===b||void 0===b};this.isVoid=B;this.getb=function(b,d){var a=f.toArray(arguments),c=null;"boolean"===typeof a[a.length-1]&&(c=a.pop());a=f.get.apply(null,a).toLowerCase();return null!==c&&""===a?c:v(a)};this.getf=function(b,d){var a=f.toArray(arguments),c=
a[a.length-1],e=null;"number"===typeof c&&(e=a.pop());null!==e&&a.push(!1);a=f.get.apply(null,a);if(null===a){if(!1===c)return a;if(e)return e;a="0.0"}return parseFloat(a)};this.geti=function(b,d){var a=f.toArray(arguments),c=a[a.length-1],e=null;"number"===typeof c&&(e=a.pop());null!==e&&a.push(!1);a=f.get.apply(null,a);if(null===a){if(!1===c)return a;a=e?""+e:"0"}return parseInt(a,10)};this.getj=function(b,d){var a=void 0,c=f.toArray(arguments),e=c[c.length-1];2<c.length?a=c[2]:1<c.length&&"string"!==
typeof e&&(a=c.pop());c=f.get.apply(null,c);try{return JSON.parse(c)}catch(g){return a}};this.valb=this.getb;this.valf=this.getf;this.val=this.get;this.vali=this.geti;this.valj=this.getj;this.set=function(b,d,a){var c=f.toArray(arguments),e=c.pop(),e=null===e||void 0===e?"":""+e;if(c=f.elt.apply(null,c))c.value=e;return e};this.sett=this.setText=function(b,d,a){var c=f.toArray(arguments),e=c.pop();if(c=f.elt.apply(null,c))c.textContent=e;return e};this.tov=this.textOrValue=function(b,d){var a=q(arguments);
if(!a.elt)throw"elt not found, no text or value";return""===a.tov&&"string"===typeof a.las?a.las:a.tov};this.tovb=function(b,d){var a=q(arguments);if(a.elt)return v(a.tov||""+a.las);throw"elt not found, no text or value";};this.tovi=function(b,d){var a=q(arguments);if(a.elt)return parseInt(a.tov||""+a.las,10);throw"elt not found, no text or value";};this.tovf=function(b,d){var a=q(arguments);if(a.elt)return parseFloat(a.tov||""+a.las);throw"elt not found, no text or value";};this.capitalize=function(b){return b.charAt(0).toUpperCase()+
b.slice(1)};this.decapitalize=function(b){return b.charAt(0).toLowerCase()+b.slice(1)};this.toCamelCase=function(b,d){b=b.replace(/([_-][a-z])/g,function(a){return a.substring(1).toUpperCase()});return d?f.capitalize(b):b};this.prepend=function(b,d,a){a||(a=d,d=b,b=null);b=h(b,d);b.parentNode.insertBefore(a,b)};this.postpend=function(b,d,a){a||(a=d,d=b,b=null);b=h(b,d);b.parentNode.insertBefore(a,b.nextSibling)};this.del=this.rem=this.remove=function(b,d,a){var c=p(arguments,!0);m(c.sta,c.sel).forEach(function(a){("function"===
typeof c.las?c.las(a):c.las)&&a.parentElement.removeChild(a)})};this.rep=this.replace=function(b,d,a){a||(a=d,d=b,b=null);b=h(b,d);d=b.parentNode;d.insertBefore(a,b);d.removeChild(b)};this.appc=this.appendFirst=this.appendAsFirstChild=function(b,d,a){a||(a=d,d=b,b=null);b=h(b,d);1>b.children.length?b.appendChild(b):b.insertBefore(a,b.children[0])};this.clean=function(b,d,a){b=h(b,d);a&&"."!==a[0]&&(a="."+a);if(a)f.forEach(b,a,function(a){a.parentElement.removeChild(a)});else for(;b.firstChild;)b.removeChild(b.firstChild);
return b};this.onDocumentReady=function(b){"loading"!=document.readyState?b():document.addEventListener("DOMContentLoaded",b)};this.makeGrower=function(b){var d=function(a){var b=[];a.replace(/([#.][^#.]+)/g,function(a){b.push({k:a[0],n:a.substring(1,a.length)})});return b};return function(){for(var a=document.createElement(b),c=0,e=arguments.length;c<e;c++){var f=arguments[c];if(!1===f)return null;if(null!==f){var k="string"===typeof f;if(!k||"."!==f[0]&&"#"!==f[0]||f.match(/^\s*$/))if(k)a.appendChild(document.createTextNode(f));
else if(void 0!==f.nodeType&&void 0!==f.innerHTML)a.appendChild(f);else if("object"===typeof f)for(var h in f)a.setAttribute("-"===h.slice(0,1)?"data"+h:h,f[h]);else a.appendChild(document.createTextNode(""+f));else d(f).forEach(function(b){"#"===b.k?a.id=b.n:a.classList.add(b.n)})}}return a}};this.c=this.create=function(b){var d=f.toArray(arguments),a=null,c=1;f.isElt(b)&&(c=2,a=b,b=d[1]);d=d.slice(c);if("string"!==typeof b)throw"parent probably null or undefined, args:"+JSON.stringify(f.toArray(arguments));
if(c=b.match(/^([a-zA-Z0-9]+)?([.#].+)$/))b=c[1]||"div",d.unshift(c[2]);d=f.makeGrower(b).apply(null,d);a&&a.appendChild(d);return d};var E="var "+"a abbr address area article aside audio b base bdi bdo blockquote br button canvas caption cite code col colgroup datalist dd del details dfn dialog div dl dt em embed fieldset figcaption figure footer form h1 h2 h3 h4 h5 h6 header hr i iframe img input ins kbd keygen label legend li main map mark menu menuitem meta meter nav noscript object ol optgroup option output p param picture pre progress q rp rt ruby s samp script section select small source span strong style sub summary sup table tbody td textarea tfoot th thead time title tr track u ul video wbr".split(" ").map(function(b){return b+
'=H.makeGrower("'+b+'")'}).join(",")+";";this.grow=function(b){b=b.toString().trim();b=b.substring(b.indexOf("{")+1,b.lastIndexOf("}"));return eval(E+b)};this.makeTemplate=function(b){return eval("("+b.toString().replace(/\{/,"{"+E)+")")};this.delay=function(b,d){var a=null;return function(){var c=arguments;window.clearTimeout(a);a=window.setTimeout(function(){d.apply(this,c)},b)}};this.makeWorker=function(b,d){var a=b.toString(),c=d,a=(c=void 0===c||!!c)?"self.addEventListener('message', "+a+", false);":
a.substring(a.indexOf("{")+1,a.lastIndexOf("}")),e=document&&document.location&&document.location.href;if(e){var f=e.lastIndexOf("/");0>f&&(f=e.length-1);e=e.substring(0,f)+"/";a='var rootUrl = "'+e+'";'+a}a=new Blob([a]);c=new Worker(window.URL.createObjectURL(a));c.on=function(a,b){c.addEventListener(a,b,!1)};return c};return this}.apply({});
/* minified from commit 942b345 on Thu Aug 12 14:29:12 JST 2021 */

var QRCode;!function(){function t(t){this.mode=r.MODE_8BIT_BYTE,this.data=t,this.parsedData=[];for(var e=0,o=this.data.length;e<o;e++){var i=[],n=this.data.charCodeAt(e);n>65536?(i[0]=240|(1835008&n)>>>18,i[1]=128|(258048&n)>>>12,i[2]=128|(4032&n)>>>6,i[3]=128|63&n):n>2048?(i[0]=224|(61440&n)>>>12,i[1]=128|(4032&n)>>>6,i[2]=128|63&n):n>128?(i[0]=192|(1984&n)>>>6,i[1]=128|63&n):i[0]=n,this.parsedData.push(i)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function e(t,e){this.typeNumber=t,this.errorCorrectLevel=e,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}t.prototype={getLength:function(t){return this.parsedData.length},write:function(t){for(var e=0,r=this.parsedData.length;e<r;e++)t.put(this.parsedData[e],8)}},e.prototype={addData:function(e){var r=new t(e);this.dataList.push(r),this.dataCache=null},isDark:function(t,e){if(t<0||this.moduleCount<=t||e<0||this.moduleCount<=e)throw new Error(t+","+e);return this.modules[t][e]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(t,r){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var o=0;o<this.moduleCount;o++){this.modules[o]=new Array(this.moduleCount);for(var i=0;i<this.moduleCount;i++)this.modules[o][i]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,r),this.typeNumber>=7&&this.setupTypeNumber(t),null==this.dataCache&&(this.dataCache=e.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,r)},setupPositionProbePattern:function(t,e){for(var r=-1;r<=7;r++)if(!(t+r<=-1||this.moduleCount<=t+r))for(var o=-1;o<=7;o++)e+o<=-1||this.moduleCount<=e+o||(this.modules[t+r][e+o]=0<=r&&r<=6&&(0==o||6==o)||0<=o&&o<=6&&(0==r||6==r)||2<=r&&r<=4&&2<=o&&o<=4)},getBestMaskPattern:function(){for(var t=0,e=0,r=0;r<8;r++){this.makeImpl(!0,r);var o=g.getLostPoint(this);(0==r||t>o)&&(t=o,e=r)}return e},createMovieClip:function(t,e,r){var o=t.createEmptyMovieClip(e,r);this.make();for(var i=0;i<this.modules.length;i++)for(var n=1*i,a=0;a<this.modules[i].length;a++){var s=1*a;this.modules[i][a]&&(o.beginFill(0,100),o.moveTo(s,n),o.lineTo(s+1,n),o.lineTo(s+1,n+1),o.lineTo(s,n+1),o.endFill())}return o},setupTimingPattern:function(){for(var t=8;t<this.moduleCount-8;t++)null==this.modules[t][6]&&(this.modules[t][6]=t%2==0);for(var e=8;e<this.moduleCount-8;e++)null==this.modules[6][e]&&(this.modules[6][e]=e%2==0)},setupPositionAdjustPattern:function(){for(var t=g.getPatternPosition(this.typeNumber),e=0;e<t.length;e++)for(var r=0;r<t.length;r++){var o=t[e],i=t[r];if(null==this.modules[o][i])for(var n=-2;n<=2;n++)for(var a=-2;a<=2;a++)this.modules[o+n][i+a]=-2==n||2==n||-2==a||2==a||0==n&&0==a}},setupTypeNumber:function(t){for(var e=g.getBCHTypeNumber(this.typeNumber),r=0;r<18;r++){var o=!t&&1==(e>>r&1);this.modules[Math.floor(r/3)][r%3+this.moduleCount-8-3]=o}for(r=0;r<18;r++){o=!t&&1==(e>>r&1);this.modules[r%3+this.moduleCount-8-3][Math.floor(r/3)]=o}},setupTypeInfo:function(t,e){for(var r=this.errorCorrectLevel<<3|e,o=g.getBCHTypeInfo(r),i=0;i<15;i++){var n=!t&&1==(o>>i&1);i<6?this.modules[i][8]=n:i<8?this.modules[i+1][8]=n:this.modules[this.moduleCount-15+i][8]=n}for(i=0;i<15;i++){n=!t&&1==(o>>i&1);i<8?this.modules[8][this.moduleCount-i-1]=n:i<9?this.modules[8][15-i-1+1]=n:this.modules[8][15-i-1]=n}this.modules[this.moduleCount-8][8]=!t},mapData:function(t,e){for(var r=-1,o=this.moduleCount-1,i=7,n=0,a=this.moduleCount-1;a>0;a-=2)for(6==a&&a--;;){for(var s=0;s<2;s++)if(null==this.modules[o][a-s]){var h=!1;n<t.length&&(h=1==(t[n]>>>i&1)),g.getMask(e,o,a-s)&&(h=!h),this.modules[o][a-s]=h,-1==--i&&(n++,i=7)}if((o+=r)<0||this.moduleCount<=o){o-=r,r=-r;break}}}},e.PAD0=236,e.PAD1=17,e.createData=function(t,r,o){for(var i=m.getRSBlocks(t,r),n=new _,a=0;a<o.length;a++){var s=o[a];n.put(s.mode,4),n.put(s.getLength(),g.getLengthInBits(s.mode,t)),s.write(n)}var h=0;for(a=0;a<i.length;a++)h+=i[a].dataCount;if(n.getLengthInBits()>8*h)throw new Error("code length overflow. ("+n.getLengthInBits()+">"+8*h+")");for(n.getLengthInBits()+4<=8*h&&n.put(0,4);n.getLengthInBits()%8!=0;)n.putBit(!1);for(;!(n.getLengthInBits()>=8*h||(n.put(e.PAD0,8),n.getLengthInBits()>=8*h));)n.put(e.PAD1,8);return e.createBytes(n,i)},e.createBytes=function(t,e){for(var r=0,o=0,i=0,n=new Array(e.length),a=new Array(e.length),s=0;s<e.length;s++){var h=e[s].dataCount,l=e[s].totalCount-h;o=Math.max(o,h),i=Math.max(i,l),n[s]=new Array(h);for(var u=0;u<n[s].length;u++)n[s][u]=255&t.buffer[u+r];r+=h;var f=g.getErrorCorrectPolynomial(l),d=new p(n[s],f.getLength()-1).mod(f);a[s]=new Array(f.getLength()-1);for(u=0;u<a[s].length;u++){var c=u+d.getLength()-a[s].length;a[s][u]=c>=0?d.get(c):0}}var m=0;for(u=0;u<e.length;u++)m+=e[u].totalCount;var _=new Array(m),v=0;for(u=0;u<o;u++)for(s=0;s<e.length;s++)u<n[s].length&&(_[v++]=n[s][u]);for(u=0;u<i;u++)for(s=0;s<e.length;s++)u<a[s].length&&(_[v++]=a[s][u]);return _};for(var r={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},o={L:1,M:0,Q:3,H:2},i=0,n=1,a=2,s=3,h=4,l=5,u=6,f=7,g={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(t){for(var e=t<<10;g.getBCHDigit(e)-g.getBCHDigit(g.G15)>=0;)e^=g.G15<<g.getBCHDigit(e)-g.getBCHDigit(g.G15);return(t<<10|e)^g.G15_MASK},getBCHTypeNumber:function(t){for(var e=t<<12;g.getBCHDigit(e)-g.getBCHDigit(g.G18)>=0;)e^=g.G18<<g.getBCHDigit(e)-g.getBCHDigit(g.G18);return t<<12|e},getBCHDigit:function(t){for(var e=0;0!=t;)e++,t>>>=1;return e},getPatternPosition:function(t){return g.PATTERN_POSITION_TABLE[t-1]},getMask:function(t,e,r){switch(t){case i:return(e+r)%2==0;case n:return e%2==0;case a:return r%3==0;case s:return(e+r)%3==0;case h:return(Math.floor(e/2)+Math.floor(r/3))%2==0;case l:return e*r%2+e*r%3==0;case u:return(e*r%2+e*r%3)%2==0;case f:return(e*r%3+(e+r)%2)%2==0;default:throw new Error("bad maskPattern:"+t)}},getErrorCorrectPolynomial:function(t){for(var e=new p([1],0),r=0;r<t;r++)e=e.multiply(new p([1,d.gexp(r)],0));return e},getLengthInBits:function(t,e){if(1<=e&&e<10)switch(t){case r.MODE_NUMBER:return 10;case r.MODE_ALPHA_NUM:return 9;case r.MODE_8BIT_BYTE:case r.MODE_KANJI:return 8;default:throw new Error("mode:"+t)}else if(e<27)switch(t){case r.MODE_NUMBER:return 12;case r.MODE_ALPHA_NUM:return 11;case r.MODE_8BIT_BYTE:return 16;case r.MODE_KANJI:return 10;default:throw new Error("mode:"+t)}else{if(!(e<41))throw new Error("type:"+e);switch(t){case r.MODE_NUMBER:return 14;case r.MODE_ALPHA_NUM:return 13;case r.MODE_8BIT_BYTE:return 16;case r.MODE_KANJI:return 12;default:throw new Error("mode:"+t)}}},getLostPoint:function(t){for(var e=t.getModuleCount(),r=0,o=0;o<e;o++)for(var i=0;i<e;i++){for(var n=0,a=t.isDark(o,i),s=-1;s<=1;s++)if(!(o+s<0||e<=o+s))for(var h=-1;h<=1;h++)i+h<0||e<=i+h||0==s&&0==h||a==t.isDark(o+s,i+h)&&n++;n>5&&(r+=3+n-5)}for(o=0;o<e-1;o++)for(i=0;i<e-1;i++){var l=0;t.isDark(o,i)&&l++,t.isDark(o+1,i)&&l++,t.isDark(o,i+1)&&l++,t.isDark(o+1,i+1)&&l++,0!=l&&4!=l||(r+=3)}for(o=0;o<e;o++)for(i=0;i<e-6;i++)t.isDark(o,i)&&!t.isDark(o,i+1)&&t.isDark(o,i+2)&&t.isDark(o,i+3)&&t.isDark(o,i+4)&&!t.isDark(o,i+5)&&t.isDark(o,i+6)&&(r+=40);for(i=0;i<e;i++)for(o=0;o<e-6;o++)t.isDark(o,i)&&!t.isDark(o+1,i)&&t.isDark(o+2,i)&&t.isDark(o+3,i)&&t.isDark(o+4,i)&&!t.isDark(o+5,i)&&t.isDark(o+6,i)&&(r+=40);var u=0;for(i=0;i<e;i++)for(o=0;o<e;o++)t.isDark(o,i)&&u++;return r+=10*(Math.abs(100*u/e/e-50)/5)}},d={glog:function(t){if(t<1)throw new Error("glog("+t+")");return d.LOG_TABLE[t]},gexp:function(t){for(;t<0;)t+=255;for(;t>=256;)t-=255;return d.EXP_TABLE[t]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},c=0;c<8;c++)d.EXP_TABLE[c]=1<<c;for(c=8;c<256;c++)d.EXP_TABLE[c]=d.EXP_TABLE[c-4]^d.EXP_TABLE[c-5]^d.EXP_TABLE[c-6]^d.EXP_TABLE[c-8];for(c=0;c<255;c++)d.LOG_TABLE[d.EXP_TABLE[c]]=c;function p(t,e){if(void 0==t.length)throw new Error(t.length+"/"+e);for(var r=0;r<t.length&&0==t[r];)r++;this.num=new Array(t.length-r+e);for(var o=0;o<t.length-r;o++)this.num[o]=t[o+r]}function m(t,e){this.totalCount=t,this.dataCount=e}function _(){this.buffer=[],this.length=0}p.prototype={get:function(t){return this.num[t]},getLength:function(){return this.num.length},multiply:function(t){for(var e=new Array(this.getLength()+t.getLength()-1),r=0;r<this.getLength();r++)for(var o=0;o<t.getLength();o++)e[r+o]^=d.gexp(d.glog(this.get(r))+d.glog(t.get(o)));return new p(e,0)},mod:function(t){if(this.getLength()-t.getLength()<0)return this;for(var e=d.glog(this.get(0))-d.glog(t.get(0)),r=new Array(this.getLength()),o=0;o<this.getLength();o++)r[o]=this.get(o);for(o=0;o<t.getLength();o++)r[o]^=d.gexp(d.glog(t.get(o))+e);return new p(r,0).mod(t)}},m.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],m.getRSBlocks=function(t,e){var r=m.getRsBlockTable(t,e);if(void 0==r)throw new Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+e);for(var o=r.length/3,i=[],n=0;n<o;n++)for(var a=r[3*n+0],s=r[3*n+1],h=r[3*n+2],l=0;l<a;l++)i.push(new m(s,h));return i},m.getRsBlockTable=function(t,e){switch(e){case o.L:return m.RS_BLOCK_TABLE[4*(t-1)+0];case o.M:return m.RS_BLOCK_TABLE[4*(t-1)+1];case o.Q:return m.RS_BLOCK_TABLE[4*(t-1)+2];case o.H:return m.RS_BLOCK_TABLE[4*(t-1)+3];default:return}},_.prototype={get:function(t){var e=Math.floor(t/8);return 1==(this.buffer[e]>>>7-t%8&1)},put:function(t,e){for(var r=0;r<e;r++)this.putBit(1==(t>>>e-r-1&1))},getLengthInBits:function(){return this.length},putBit:function(t){var e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++}};var v=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]];function C(){var t=!1,e=navigator.userAgent;if(/android/i.test(e)){t=!0;var r=e.toString().match(/android ([0-9]\.[0-9])/i);r&&r[1]&&(t=parseFloat(r[1]))}return t}var w=function(){var t=function(t,e){this._el=t,this._htOption=e};return t.prototype.draw=function(t){var e=this._htOption,r=this._el,o=t.getModuleCount();Math.floor(e.width/o),Math.floor(e.height/o);function i(t,e){var r=document.createElementNS("http://www.w3.org/2000/svg",t);for(var o in e)e.hasOwnProperty(o)&&r.setAttribute(o,e[o]);return r}this.clear();var n=i("svg",{viewBox:"0 0 "+String(o)+" "+String(o),width:"100%",height:"100%",fill:e.colorLight});n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),r.appendChild(n),n.appendChild(i("rect",{fill:e.colorLight,width:"100%",height:"100%"})),n.appendChild(i("rect",{fill:e.colorDark,width:"1",height:"1",id:"template"}));for(var a=0;a<o;a++)for(var s=0;s<o;s++)if(t.isDark(a,s)){var h=i("use",{x:String(s),y:String(a)});h.setAttributeNS("http://www.w3.org/1999/xlink","href","#template"),n.appendChild(h)}},t.prototype.clear=function(){for(;this._el.hasChildNodes();)this._el.removeChild(this._el.lastChild)},t}(),D="svg"===document.documentElement.tagName.toLowerCase()?w:"undefined"==typeof CanvasRenderingContext2D?function(){var t=function(t,e){this._el=t,this._htOption=e};return t.prototype.draw=function(t){for(var e=this._htOption,r=this._el,o=t.getModuleCount(),i=Math.floor(e.width/o),n=Math.floor(e.height/o),a=['<table style="border:0;border-collapse:collapse;">'],s=0;s<o;s++){a.push("<tr>");for(var h=0;h<o;h++)a.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+i+"px;height:"+n+"px;background-color:"+(t.isDark(s,h)?e.colorDark:e.colorLight)+';"></td>');a.push("</tr>")}a.push("</table>"),r.innerHTML=a.join("");var l=r.childNodes[0],u=(e.width-l.offsetWidth)/2,f=(e.height-l.offsetHeight)/2;u>0&&f>0&&(l.style.margin=f+"px "+u+"px")},t.prototype.clear=function(){this._el.innerHTML=""},t}():function(){function t(){this._elImage.src=this._elCanvas.toDataURL("image/png"),this._elImage.style.display="block",this._elCanvas.style.display="none"}if(this._android&&this._android<=2.1){var e=1/window.devicePixelRatio,r=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(t,o,i,n,a,s,h,l,u){if("nodeName"in t&&/img/i.test(t.nodeName))for(var f=arguments.length-1;f>=1;f--)arguments[f]=arguments[f]*e;else void 0===l&&(arguments[1]*=e,arguments[2]*=e,arguments[3]*=e,arguments[4]*=e);r.apply(this,arguments)}}var o=function(t,e){this._bIsPainted=!1,this._android=C(),this._htOption=e,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=e.width,this._elCanvas.height=e.height,t.appendChild(this._elCanvas),this._el=t,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._elImage=document.createElement("img"),this._elImage.alt="Scan me!",this._elImage.style.display="none",this._el.appendChild(this._elImage),this._bSupportDataURI=null};return o.prototype.draw=function(t){var e=this._elImage,r=this._oContext,o=this._htOption,i=t.getModuleCount(),n=o.width/i,a=o.height/i,s=Math.round(n),h=Math.round(a);e.style.display="none",this.clear();for(var l=0;l<i;l++)for(var u=0;u<i;u++){var f=t.isDark(l,u),g=u*n,d=l*a;r.strokeStyle=f?o.colorDark:o.colorLight,r.lineWidth=1,r.fillStyle=f?o.colorDark:o.colorLight,r.fillRect(g,d,n,a),r.strokeRect(Math.floor(g)+.5,Math.floor(d)+.5,s,h),r.strokeRect(Math.ceil(g)-.5,Math.ceil(d)-.5,s,h)}this._bIsPainted=!0},o.prototype.makeImage=function(){this._bIsPainted&&function(t,e){var r=this;if(r._fFail=e,r._fSuccess=t,null===r._bSupportDataURI){var o=document.createElement("img"),i=function(){r._bSupportDataURI=!1,r._fFail&&r._fFail.call(r)};return o.onabort=i,o.onerror=i,o.onload=function(){r._bSupportDataURI=!0,r._fSuccess&&r._fSuccess.call(r)},void(o.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==")}!0===r._bSupportDataURI&&r._fSuccess?r._fSuccess.call(r):!1===r._bSupportDataURI&&r._fFail&&r._fFail.call(r)}.call(this,t)},o.prototype.isPainted=function(){return this._bIsPainted},o.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},o.prototype.round=function(t){return t?Math.floor(1e3*t)/1e3:t},o}();function A(t,e){for(var r=1,i=function(t){var e=encodeURI(t).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return e.length+(e.length!=t?3:0)}(t),n=0,a=v.length;n<=a;n++){var s=0;switch(e){case o.L:s=v[n][0];break;case o.M:s=v[n][1];break;case o.Q:s=v[n][2];break;case o.H:s=v[n][3]}if(i<=s)break;r++}if(r>v.length)throw new Error("Too long data");return r}(QRCode=function(t,e){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:o.H},"string"==typeof e&&(e={text:e}),e)for(var r in e)this._htOption[r]=e[r];"string"==typeof t&&(t=document.getElementById(t)),this._htOption.useSVG&&(D=w),this._android=C(),this._el=t,this._oQRCode=null,this._oDrawing=new D(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)}).prototype.makeCode=function(t){this._oQRCode=new e(A(t,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(t),this._oQRCode.make(),this._el.title=t,this._oDrawing.draw(this._oQRCode),this.makeImage()},QRCode.prototype.makeImage=function(){"function"==typeof this._oDrawing.makeImage&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},QRCode.prototype.clear=function(){this._oDrawing.clear()},QRCode.CorrectLevel=o}(),"undefined"!=typeof module&&(module.exports=QRCode);

    </script>
  </head>

  <body>

    <pre id="result">
    </pre>

    <div id="directory">
      <ul>
<!-- DIRECTORY -->
      </ul>
    </div>

    <div id="codes">
      <div class="self">
        <div class="code"></div>
        <div class="label">
          self
          <img class="copy" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgMjEwLjEwNyAyMTAuMTA3IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAyMTAuMTA3IDIxMC4xMDc7IiB4bWw6c3BhY2U9InByZXNlcnZlIj48Zz48cGF0aCBzdHlsZT0iZmlsbDojMUQxRDFCOyIgZD0iTTE2OC41MDYsMEg4MC4yMzVDNjcuNDEzLDAsNTYuOTgxLDEwLjQzMiw1Ni45ODEsMjMuMjU0djIuODU0aC0xNS4zOCBjLTEyLjgyMiwwLTIzLjI1NCwxMC40MzItMjMuMjU0LDIzLjI1NHYxMzcuNDkyYzAsMTIuODIyLDEwLjQzMiwyMy4yNTQsMjMuMjU0LDIzLjI1NGg4OC4yNzEgYzEyLjgyMiwwLDIzLjI1My0xMC40MzIsMjMuMjUzLTIzLjI1NFYxODRoMTUuMzhjMTIuODIyLDAsMjMuMjU0LTEwLjQzMiwyMy4yNTQtMjMuMjU0VjIzLjI1NEMxOTEuNzYsMTAuNDMyLDE4MS4zMjgsMCwxNjguNTA2LDB6IE0xMzguMTI2LDE4Ni44NTRjMCw0LjU1MS0zLjcwMyw4LjI1NC04LjI1Myw4LjI1NEg0MS42MDFjLTQuNTUxLDAtOC4yNTQtMy43MDMtOC4yNTQtOC4yNTRWNDkuMzYxIGMwLTQuNTUxLDMuNzAzLTguMjU0LDguMjU0LTguMjU0aDg4LjI3MWM0LjU1MSwwLDguMjUzLDMuNzAzLDguMjUzLDguMjU0VjE4Ni44NTR6IE0xNzYuNzYsMTYwLjc0NiBjMCw0LjU1MS0zLjcwMyw4LjI1NC04LjI1NCw4LjI1NGgtMTUuMzhWNDkuMzYxYzAtMTIuODIyLTEwLjQzMi0yMy4yNTQtMjMuMjUzLTIzLjI1NEg3MS45ODF2LTIuODU0IGMwLTQuNTUxLDMuNzAzLTguMjU0LDguMjU0LTguMjU0aDg4LjI3MWM0LjU1MSwwLDguMjU0LDMuNzAzLDguMjU0LDguMjU0VjE2MC43NDZ6Ii8+PC9nPjwvc3ZnPgo=
"></img>
        </div>
      </div>
      <div class="text">
        <div class="code"></div>
        <div class="label">
          text
          <img class="copy" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgMjEwLjEwNyAyMTAuMTA3IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAyMTAuMTA3IDIxMC4xMDc7IiB4bWw6c3BhY2U9InByZXNlcnZlIj48Zz48cGF0aCBzdHlsZT0iZmlsbDojMUQxRDFCOyIgZD0iTTE2OC41MDYsMEg4MC4yMzVDNjcuNDEzLDAsNTYuOTgxLDEwLjQzMiw1Ni45ODEsMjMuMjU0djIuODU0aC0xNS4zOCBjLTEyLjgyMiwwLTIzLjI1NCwxMC40MzItMjMuMjU0LDIzLjI1NHYxMzcuNDkyYzAsMTIuODIyLDEwLjQzMiwyMy4yNTQsMjMuMjU0LDIzLjI1NGg4OC4yNzEgYzEyLjgyMiwwLDIzLjI1My0xMC40MzIsMjMuMjUzLTIzLjI1NFYxODRoMTUuMzhjMTIuODIyLDAsMjMuMjU0LTEwLjQzMiwyMy4yNTQtMjMuMjU0VjIzLjI1NEMxOTEuNzYsMTAuNDMyLDE4MS4zMjgsMCwxNjguNTA2LDB6IE0xMzguMTI2LDE4Ni44NTRjMCw0LjU1MS0zLjcwMyw4LjI1NC04LjI1Myw4LjI1NEg0MS42MDFjLTQuNTUxLDAtOC4yNTQtMy43MDMtOC4yNTQtOC4yNTRWNDkuMzYxIGMwLTQuNTUxLDMuNzAzLTguMjU0LDguMjU0LTguMjU0aDg4LjI3MWM0LjU1MSwwLDguMjUzLDMuNzAzLDguMjUzLDguMjU0VjE4Ni44NTR6IE0xNzYuNzYsMTYwLjc0NiBjMCw0LjU1MS0zLjcwMyw4LjI1NC04LjI1NCw4LjI1NGgtMTUuMzhWNDkuMzYxYzAtMTIuODIyLTEwLjQzMi0yMy4yNTQtMjMuMjUzLTIzLjI1NEg3MS45ODF2LTIuODU0IGMwLTQuNTUxLDMuNzAzLTguMjU0LDguMjU0LTguMjU0aDg4LjI3MWM0LjU1MSwwLDguMjU0LDMuNzAzLDguMjU0LDguMjU0VjE2MC43NDZ6Ii8+PC9nPjwvc3ZnPgo=
"></img>
        </div>
      </div>
    </div>

    <div id="copyright">
      <a href="https://github.com/jmettraux/maboroshi">maboroshi</a> -
      MIT license -
      <a href="https://weaver.skepti.ch?f=maboroshi">Jehan Mestral</a> 2022
    </div>

    <div id="flash" style="display: none;">flash</div>

    <textarea id="clip"></textarea>

    <script>

      var clog = console.log;
      var cerr = console.error;

      var qrwidth = 168;

      var roll = function(table) {

        table.roll()
          .then(function(r) {

            H.setText('#result', r);
            H.unhide('#result');

            //var qt = r
            //  .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
            //  .slice(0, 4 * 1024);

            new QRCode(
              H.elt('#codes .text .code'),
              { text: r,
                width: qrwidth,
                height: qrwidth,
                colorDark: '#000000',
                colorLight: '#ffffff',
                correctLevel: QRCode.CorrectLevel.H });

            var ve = H.elt('#codes .text img.copy');
            ve._text = r;
            ve._what = 'text';
          });
      };

      H.onDocumentReady(function() {

        H.hide('#result');

        var ss = window.location.search
          .split(/[?&]/)
          .filter(function(e) { return e.length > 0; });
        var table = ss.find(function(e) { return e.match(/^table=.+/); });

        if (table) {

          H.hide('#directory');

          var u = decodeURIComponent(table.slice(6));

          MaboTableSet.make(u)
            .then(roll)
            .catch(function(e) { cerr(e); })
        }

        new QRCode(
          H.elt('#codes .self .code'),
          { text: window.location.href,
            width: qrwidth,
            height: qrwidth,
            colorDark: '#000000',
            colorLight: '#ffffff',
            correctLevel: QRCode.CorrectLevel.H });

        var ve = H.elt('#codes .self img.copy');
        ve._text = window.location.href;
        ve._what = '"' + window.location.href + '"';

        H.on('img.copy', 'click', function(ev) {
          var ce = H.elt('#clip');
          var fe = H.elt('#flash');
          ce.value = ev.target._text;
          ce.select();
          document.execCommand('copy');
          window.setTimeout(function() { ce.blur(); }, 100);
          fe.textContent = ev.target._what + " copied";
          fe.style.display = 'block';
          window.setTimeout(function() { fe.style.display = 'none'; }, 2100);
        });
      });
    </script>
  </body>
</html>

